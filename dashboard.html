<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Portal - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/style.css" rel="stylesheet">
</head>
<body class="bg-light">
    <header class="container py-3">
        <div class="d-flex justify-content-between align-items-center">
            <h1>Student Dashboard</h1>
            <div class="d-flex gap-2">
                <a href="courses2.html" class="btn btn-secondary">Courses Plan</a>
                <a href="menu.html" class="btn btn-secondary">Back to Menu</a>
            </div>
        </div>
    </header>

    <main class="container mt-4">
        <div class="row g-4">
            <!-- Profile Section -->
            <div class="col-md-4">
                <div class="card shadow">
                    <div class="card-body text-center">
                        <img src="assets/image/johndoe.jpg" alt="Profile" class="rounded-circle mb-3">
                        <h3>John Doe</h3>
                        <p class="text-muted">Computer Science</p>
                        <div class="list-group">
                            <div class="list-group-item">Student ID: 123456</div>
                            <div class="list-group-item">Email: john@student.uitm.edu.my</div>
                            <div class="list-group-item">Semester: 4</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Academic Summary -->
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-body">
                        <h4 class="mb-4">Academic Summary</h4>
                        
                        <div class="row mb-4">
                            <div class="col-6 col-md-3">
                                <div class="card text-white bg-primary mb-3">
                                    <div class="card-body text-center">
                                        <h5>CGPA</h5>
                                        <h2>3.75</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="card text-white bg-success mb-3">
                                    <div class="card-body text-center">
                                        <h5>Credits</h5>
                                        <h2>27</h2>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h5 class="mb-3">Current Timetable</h5>
                        <table class="table table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th>Time</th>
                                    <th>Monday</th>
                                    <th>Wednesday</th>
                                    <th>Friday</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>9-11AM</td>
                                    <td>Web Development</td>
                                    <td>Database Systems</td>
                                    <td>Networking</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card shadow mt-4">
                    <div class="card-body">
                        <h4 class="mb-4">Discussions</h4>
                        <form id="messageForm">
                            <div class="mb-3">
                                <input type="text" class="form-control" id="messageInput" placeholder="Write your message...">
                            </div>
                            <div class="mb-3">
                                <input type="file" class="form-control" id="fileUpload">
                            </div>
                            <button type="submit" class="btn btn-primary">Post Message</button>
                        </form>
                        <div id="messageFeed" class="mt-4"></div>
                    </div>
                </div>
                </div>
            </div>
        </div>
    </main>
<br><br>
    <footer class="bg-dark text-white py-3 mt-auto">
        <div class="container">
            <p class="mb-0 text-center">&copy; 2024 Student Portal. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
<script>
document.addEventListener('DOMContentLoaded', function() {
  if (sessionStorage.getItem('authenticated') !== 'true') {
    window.location.href = 'login.html';
  }

  document.getElementById('logoutBtn').addEventListener('click', function() {
  sessionStorage.removeItem('authenticated');
  window.location.href = 'login.html';
});
});

// Add message handling functionality
const messageForm = document.getElementById('messageForm');
const messageFeed = document.getElementById('messageFeed');

let messages = JSON.parse(localStorage.getItem('communityMessages')) || [];

function renderMessages() {
    messageFeed.innerHTML = messages.map((msg, index) => `
        <div class="card mb-3">
            <div class="card-body">
                <p>${msg.text}</p>
                ${msg.file ? `<a href="#" class="text-decoration-none">ðŸ“Ž ${msg.file}</a>` : ''}
                <div class="mt-2 text-muted small">${new Date(msg.timestamp).toLocaleString()}</div>
                <div class="mt-2">
                    <button onclick="deleteMessage(${index})" class="btn btn-sm btn-danger">Delete</button>
                </div>
                <div class="reply-section mt-3">
                    ${msg.replies ? msg.replies.map(reply => 
                        `<div class="ms-4 border-start ps-3 mb-2">
                            <small>${reply.text}</small>
                            <div class="text-muted x-small">${new Date(reply.timestamp).toLocaleString()}</div>
                        </div>`
                    ).join('') : ''}
                    <div class="input-group mt-2">
                        <input type="text" class="form-control reply-input" placeholder="Write a reply..." data-message-index="${index}">
                        <button class="btn btn-outline-primary reply-btn" data-message-index="${index}">Reply</button>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
}

messageForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const messageText = document.getElementById('messageInput').value;
    const fileName = document.getElementById('fileUpload').files[0]?.name || '';
    
    if (messageText) {
        messages.push({
            text: messageText,
            file: fileName,
            timestamp: new Date().toISOString()
        });
        localStorage.setItem('communityMessages', JSON.stringify(messages));
        renderMessages();
        messageForm.reset();
    }
});

function deleteMessage(index) {
    messages.splice(index, 1);
    localStorage.setItem('communityMessages', JSON.stringify(messages));
    renderMessages();
}

// Add reply functionality
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('reply-btn')) {
        const index = e.target.dataset.messageIndex;
        const input = document.querySelector(`.reply-input[data-message-index="${index}"]`);
        const replyText = input.value.trim();
        
        if (replyText) {
            if (!messages[index].replies) messages[index].replies = [];
            messages[index].replies.push({
                text: replyText,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('communityMessages', JSON.stringify(messages));
            renderMessages();
            input.value = '';
        }
    }
});
renderMessages();
</script>